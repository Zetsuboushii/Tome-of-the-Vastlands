<nav class="site-nav" role="navigation">
    <div class="nav-wrapper">
        <ul id="myList">
            {%- assign default_paths = site.pages | map: "path" -%}
            {%- assign page_paths = site.header_pages | default: default_paths -%}
            {%- for path in page_paths -%}
            {%- assign my_page = site.pages | where: "path", path | first -%}
            {%- if my_page.title -%}
            {%- assign cat = my_page.category -%}
            <li id="{{ cat }}" data-cat="{{ cat }}">
                <a class="page-link" href="{{ my_page.url | relative_url }}"> {{ my_page.title | escape }}</a>

                {%- if cat -%}
                <ul class="sublist">
                    {%- for subpage in site.entries -%}
                    {%- if subpage.categories contains cat -%}
                    <li><a class="page-link" href="{{ subpage.url | relative_url }}"> {{ subpage.title | escape }}</a>
                    </li>
                    {%- endif -%}
                    {%- endfor -%}
                </ul>
                {%- endif -%}
            </li>
            {%- endif -%}
            {%- endfor -%}
        </ul>
    </div>
</nav>

<script>
    // Funktion zum Überprüfen, ob der aktuelle URL-Pfad eine Kategorie enthält
    function urlContainsCategory(cat) {
        const currentURL = window.location.href;
        return currentURL.includes(cat);
    }

    // Suche nach allen Listenelementen in der Navigation
    const listItems = document.querySelectorAll('#myList > li');

    listItems.forEach(item => {
        // Hole die Kategorie aus dem data-cat-Attribut des Listenelements
        const cat = item.getAttribute('data-cat');

        // Toggle-Logik für das Klicken auf das Listenelement
        item.addEventListener('click', (event) => {
            // Toggle the 'active' class on the clicked item
            item.classList.toggle('active');

            // Handle the sublist expand/collapse
            const sublist = item.querySelector('.sublist');
            if (sublist) {
                if (sublist.style.maxHeight) {
                    sublist.style.maxHeight = null;
                } else {
                    sublist.style.maxHeight = sublist.scrollHeight + "px";
                }
            }

            // Prevent click event from bubbling to parent
            event.stopPropagation();
        });

        // Automatisches Ausklappen, wenn die Kategorie in der URL enthalten ist
        if (cat && urlContainsCategory(cat)) {
            item.classList.add('active');  // Füge die Klasse 'active' hinzu

            const sublist = item.querySelector('.sublist');
            if (sublist) {
                sublist.style.maxHeight = sublist.scrollHeight + "px"; // Entfalten
            }
        }
    });

    // Prevent subitems from causing the parent item to collapse when clicked
    const sublistItems = document.querySelectorAll('.sublist li');

    sublistItems.forEach(subItem => {
        subItem.addEventListener('click', (event) => {
            event.stopPropagation(); // Stops the click event from reaching the parent
        });
    });
</script>